<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Advanced PDF to Word Converter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    header {
      background: linear-gradient(to right, #4a6ee0, #2a4cb3);
      color: white;
      padding: 30px;
      text-align: center;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    header p {
      opacity: 0.9;
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .main-content {
      display: flex;
      flex-wrap: wrap;
      padding: 30px;
      gap: 30px;
    }

    .upload-section {
      flex: 1;
      min-width: 300px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .upload-area {
      border: 3px dashed #4a6ee0;
      border-radius: 12px;
      padding: 50px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background-color: white;
      margin-bottom: 25px;
    }

    .upload-area:hover {
      background-color: #f0f5ff;
      border-color: #2a4cb3;
      transform: translateY(-5px);
    }

    .upload-area i {
      font-size: 4rem;
      color: #4a6ee0;
      margin-bottom: 20px;
    }

    .upload-area h3 {
      margin-bottom: 15px;
      color: #333;
      font-size: 1.5rem;
    }

    .upload-area p {
      color: #666;
      margin-bottom: 10px;
    }

    #pdf-upload {
      display: none;
    }

    .upload-btn {
      background: linear-gradient(to right, #4a6ee0, #2a4cb3);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 15px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 15px rgba(74, 110, 224, 0.3);
    }

    .file-info {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .info-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .info-label {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #555;
    }

    .info-label i {
      color: #4a6ee0;
      width: 20px;
    }

    .info-value {
      font-weight: 600;
      color: #333;
    }

    .settings-section {
      flex: 1;
      min-width: 300px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .section-title {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      color: #2a4cb3;
      font-size: 1.3rem;
      gap: 10px;
    }

    .section-title i {
      font-size: 1.5rem;
    }

    .settings-group {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .settings-group h4 {
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-group h4 i {
      color: #4a6ee0;
    }

    .option-group {
      margin: 15px 0;
    }

    .option-label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .option-label input[type="radio"],
    .option-label input[type="checkbox"] {
      margin-right: 5px;
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .radio-option:hover {
      background-color: #f0f5ff;
    }

    .radio-option input[type="radio"] {
      margin-right: 5px;
    }

    .convert-section {
      flex: 2;
      min-width: 500px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .preview-container {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 25px;
      min-height: 300px;
      max-height: 400px;
      overflow-y: auto;
    }

    .preview-content {
      font-family: 'Georgia', serif;
      line-height: 1.6;
      color: #333;
    }

    .preview-page {
      margin-bottom: 30px;
      padding-bottom: 30px;
      border-bottom: 1px solid #eee;
    }

    .preview-page:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #4a6ee0;
    }

    .page-number {
      background: #4a6ee0;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
    }

    .empty-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px;
      color: #888;
      text-align: center;
    }

    .empty-preview i {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #ccc;
    }

    .progress-container {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      margin-bottom: 25px;
      display: none;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .progress-bar {
      height: 10px;
      background: #e9ecef;
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #4a6ee0, #2a4cb3);
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: #666;
    }

    .action-section {
      padding: 25px 30px;
      background: #f8f9fa;
      border-top: 1px solid #e0e0e0;
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 15px 35px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s;
      min-width: 200px;
      justify-content: center;
    }

    .primary-btn {
      background: linear-gradient(to right, #28a745, #1e7e34);
      color: white;
    }

    .primary-btn:hover:not(:disabled) {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    }

    .secondary-btn {
      background: #6c757d;
      color: white;
    }

    .secondary-btn:hover {
      background: #5a6268;
      transform: translateY(-5px);
    }

    .action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #28a745;
      color: white;
      padding: 18px 25px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
      max-width: 350px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .error-message {
      background: #dc3545;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      display: none;
    }

    .file-list {
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: white;
      margin-bottom: 8px;
      border-radius: 6px;
      border-left: 4px solid #4a6ee0;
    }

    .file-item .remove-file {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      width: 25px;
      height: 25px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quality-preset {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .preset-btn {
      padding: 8px 15px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 6px;
      cursor: pointer;
    }

    .preset-btn.active {
      background: #4a6ee0;
      color: white;
      border-color: #4a6ee0;
    }

    @media (max-width: 1100px) {
      .main-content {
        flex-direction: column;
      }
      
      .upload-section, .settings-section, .convert-section {
        min-width: 100%;
      }
    }

    @media (max-width: 768px) {
      .action-section {
        flex-direction: column;
      }
      
      .action-btn {
        width: 100%;
      }
      
      header h1 {
        font-size: 2rem;
      }
    }

    .ocr-warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 0.9rem;
    }

    .ocr-warning i {
      color: #ffc107;
      margin-right: 10px;
    }

    .advanced-settings {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .toggle-advanced {
      background: none;
      border: none;
      color: #4a6ee0;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    .advanced-content {
      display: none;
    }

    .advanced-content.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .language-select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ced4da;
      border-radius: 6px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-file-word"></i> PDF to Word Converter</h1>
      <p>Convert PDF documents to editable Word files with advanced OCR, formatting preservation, and batch processing capabilities.</p>
    </header>

    <div class="main-content">
      <div class="upload-section">
        <div class="upload-area" id="upload-area">
          <i class="fas fa-file-pdf"></i>
          <h3>Upload PDF Files</h3>
          <p>Drag & drop or click to select PDF files</p>
          <p>Supports multiple files up to 50MB each</p>
          <button class="upload-btn" id="upload-pdf-btn">
            <i class="fas fa-folder-open"></i> Select PDF Files
          </button>
          <input type="file" id="pdf-upload" accept=".pdf" multiple>
        </div>

        <div class="file-info">
          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-file-alt"></i>
              <span>Files Selected:</span>
            </div>
            <div class="info-value" id="file-count">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-weight-hanging"></i>
              <span>Total Size:</span>
            </div>
            <div class="info-value" id="total-size">0 MB</div>
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-clock"></i>
              <span>Estimated Time:</span>
            </div>
            <div class="info-value" id="estimated-time">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">
              <i class="fas fa-file-word"></i>
              <span>Output Format:</span>
            </div>
            <div class="info-value">DOCX</div>
          </div>
        </div>

        <div class="file-list" id="file-list" style="display: none;">
          <h4>Selected PDFs:</h4>
          <!-- Files will be added here dynamically -->
        </div>
      </div>

      <div class="settings-section">
        <div class="section-title">
          <i class="fas fa-sliders-h"></i>
          <h3>Conversion Settings</h3>
        </div>
        
        <div class="settings-group">
          <h4><i class="fas fa-cog"></i> Output Format</h4>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="format-docx" name="format" value="docx" checked>
              <label for="format-docx">DOCX (Microsoft Word)</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="format-doc" name="format" value="doc">
              <label for="format-doc">DOC (Word 97-2003)</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="format-rtf" name="format" value="rtf">
              <label for="format-rtf">RTF (Rich Text Format)</label>
            </div>
          </div>
        </div>
        
        <div class="settings-group">
          <h4><i class="fas fa-text-height"></i> Text Recognition</h4>
          <div class="option-group">
            <div class="option-label">
              <input type="checkbox" id="enable-ocr" checked>
              <label for="enable-ocr">Enable OCR (Text Recognition)</label>
            </div>
            <div class="option-label">
              <input type="checkbox" id="preserve-layout" checked>
              <label for="preserve-layout">Preserve Original Layout</label>
            </div>
            <div class="option-label">
              <input type="checkbox" id="extract-images" checked>
              <label for="extract-images">Extract Images</label>
            </div>
          </div>
          
          <div class="ocr-warning" id="ocr-warning">
            <i class="fas fa-exclamation-triangle"></i>
            OCR mode may increase processing time but ensures better text extraction from scanned PDFs.
          </div>
        </div>
        
        <div class="settings-group">
          <h4><i class="fas fa-font"></i> Text Settings</h4>
          <div class="option-group">
            <div class="option-label">
              <input type="checkbox" id="preserve-fonts" checked>
              <label for="preserve-fonts">Preserve Font Styles</label>
            </div>
            <div class="option-label">
              <input type="checkbox" id="preserve-headings" checked>
              <label for="preserve-headings">Detect Headings</label>
            </div>
            <div class="option-label">
              <input type="checkbox" id="preserve-lists" checked>
              <label for="preserve-lists">Preserve Lists Formatting</label>
            </div>
            <div class="option-label">
              <input type="checkbox" id="preserve-tables" checked>
              <label for="preserve-tables">Preserve Tables</label>
            </div>
          </div>
        </div>
        
        <div class="advanced-settings">
          <button class="toggle-advanced" id="toggle-advanced">
            <i class="fas fa-chevron-down"></i>
            <span>Advanced Settings</span>
          </button>
          
          <div class="advanced-content" id="advanced-content">
            <div class="option-group">
              <div class="option-label">
                <label for="ocr-language">OCR Language:</label>
              </div>
              <select id="ocr-language" class="language-select">
                <option value="eng" selected>English</option>
                <option value="spa">Spanish</option>
                <option value="fra">French</option>
                <option value="deu">German</option>
                <option value="ita">Italian</option>
                <option value="por">Portuguese</option>
                <option value="rus">Russian</option>
                <option value="chi_sim">Chinese (Simplified)</option>
                <option value="jpn">Japanese</option>
                <option value="kor">Korean</option>
                <option value="ara">Arabic</option>
                <option value="hin">Hindi</option>
              </select>
            </div>
            
            <div class="option-group">
              <div class="option-label">
                <input type="checkbox" id="enhance-images">
                <label for="enhance-images">Enhance Image Quality</label>
              </div>
              <div class="option-label">
                <input type="checkbox" id="remove-watermarks">
                <label for="remove-watermarks">Remove Watermarks</label>
              </div>
              <div class="option-label">
                <input type="checkbox" id="extract-annotations">
                <label for="extract-annotations">Extract Comments & Annotations</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="convert-section">
        <div class="preview-container" id="preview-container">
          <div class="empty-preview" id="empty-preview">
            <i class="fas fa-file-alt"></i>
            <h3>No PDF Uploaded</h3>
            <p>Upload a PDF file to see preview here</p>
            <p>Text content will be extracted for preview</p>
          </div>
          
          <div class="preview-content" id="preview-content">
            <!-- PDF preview will be displayed here -->
          </div>
        </div>
        
        <div class="progress-container" id="progress-container">
          <div class="progress-header">
            <h4><i class="fas fa-sync-alt"></i> Converting PDF to Word</h4>
            <span id="progress-percentage">0%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-info">
            <span id="current-file">Processing...</span>
            <span id="time-remaining">Estimating time...</span>
          </div>
        </div>
        
        <div class="error-message" id="error-message">
          <i class="fas fa-exclamation-circle"></i>
          <span id="error-text">An error occurred during conversion.</span>
        </div>
      </div>
    </div>

    <div class="action-section">
      <button class="action-btn primary-btn" id="convert-btn" disabled>
        <i class="fas fa-file-word"></i> Convert to Word
      </button>
      <button class="action-btn secondary-btn" id="clear-btn">
        <i class="fas fa-trash-alt"></i> Clear All Files
      </button>
      <button class="action-btn secondary-btn" id="sample-btn">
        <i class="fas fa-download"></i> Download Sample PDF
      </button>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i> Conversion completed successfully!
  </div>

  <!-- Include necessary libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.8/mammoth.browser.min.js"></script>
  
  <script>
    // DOM Elements
    const uploadArea = document.getElementById('upload-area');
    const pdfUpload = document.getElementById('pdf-upload');
    const uploadPdfBtn = document.getElementById('upload-pdf-btn');
    const convertBtn = document.getElementById('convert-btn');
    const clearBtn = document.getElementById('clear-btn');
    const sampleBtn = document.getElementById('sample-btn');
    const notification = document.getElementById('notification');
    const progressContainer = document.getElementById('progress-container');
    const previewContainer = document.getElementById('preview-container');
    const emptyPreview = document.getElementById('empty-preview');
    const previewContent = document.getElementById('preview-content');
    const errorMessage = document.getElementById('error-message');
    const errorText = document.getElementById('error-text');
    const fileList = document.getElementById('file-list');
    
    // Info elements
    const fileCount = document.getElementById('file-count');
    const totalSize = document.getElementById('total-size');
    const estimatedTime = document.getElementById('estimated-time');
    
    // Progress elements
    const progressFill = document.getElementById('progress-fill');
    const progressPercentage = document.getElementById('progress-percentage');
    const currentFile = document.getElementById('current-file');
    const timeRemaining = document.getElementById('time-remaining');
    
    // Settings elements
    const enableOcr = document.getElementById('enable-ocr');
    const preserveLayout = document.getElementById('preserve-layout');
    const extractImages = document.getElementById('extract-images');
    const preserveFonts = document.getElementById('preserve-fonts');
    const preserveHeadings = document.getElementById('preserve-headings');
    const preserveLists = document.getElementById('preserve-lists');
    const preserveTables = document.getElementById('preserve-tables');
    const ocrWarning = document.getElementById('ocr-warning');
    const toggleAdvanced = document.getElementById('toggle-advanced');
    const advancedContent = document.getElementById('advanced-content');
    const ocrLanguage = document.getElementById('ocr-language');
    const enhanceImages = document.getElementById('enhance-images');
    const removeWatermarks = document.getElementById('remove-watermarks');
    const extractAnnotations = document.getElementById('extract-annotations');
    
    // State variables
    let pdfFiles = [];
    let isConverting = false;
    let advancedSettingsVisible = false;

    // Initialize PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js`;

    // Event Listeners
    uploadArea.addEventListener('click', () => pdfUpload.click());
    uploadPdfBtn.addEventListener('click', () => pdfUpload.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = '#f0f5ff';
      uploadArea.style.borderColor = '#2a4cb3';
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.backgroundColor = 'white';
      uploadArea.style.borderColor = '#4a6ee0';
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = 'white';
      uploadArea.style.borderColor = '#4a6ee0';
      
      if (e.dataTransfer.files.length) {
        handlePdfUpload(Array.from(e.dataTransfer.files));
      }
    });

    pdfUpload.addEventListener('change', (event) => {
      handlePdfUpload(Array.from(event.target.files));
    });

    convertBtn.addEventListener('click', convertToWord);
    clearBtn.addEventListener('click', clearAllFiles);
    sampleBtn.addEventListener('click', downloadSamplePdf);
    
    enableOcr.addEventListener('change', () => {
      ocrWarning.style.display = enableOcr.checked ? 'block' : 'none';
    });
    
    toggleAdvanced.addEventListener('click', () => {
      advancedSettingsVisible = !advancedSettingsVisible;
      advancedContent.classList.toggle('show', advancedSettingsVisible);
      toggleAdvanced.innerHTML = advancedSettingsVisible ? 
        '<i class="fas fa-chevron-up"></i><span>Advanced Settings</span>' : 
        '<i class="fas fa-chevron-down"></i><span>Advanced Settings</span>';
    });

    // Functions
    function handlePdfUpload(files) {
      const validFiles = Array.from(files).filter(file => 
        file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')
      );
      
      if (validFiles.length === 0) {
        showNotification('No valid PDF files selected', 'error');
        return;
      }
      
      // Check file size (limit 50MB per file)
      const oversizedFiles = validFiles.filter(file => file.size > 50 * 1024 * 1024);
      if (oversizedFiles.length > 0) {
        showNotification(`${oversizedFiles.length} files exceed 50MB limit`, 'warning');
        validFiles = validFiles.filter(file => file.size <= 50 * 1024 * 1024);
      }
      
      // Limit to 10 files for performance
      if (validFiles.length > 10) {
        showNotification('Maximum 10 files allowed. First 10 will be used.', 'warning');
        validFiles.splice(10);
      }
      
      // Process each file
      validFiles.forEach(file => {
        const fileData = {
          id: Date.now() + Math.random(),
          name: file.name,
          size: file.size,
          file: file,
          pages: 0,
          previewText: ''
        };
        
        pdfFiles.push(fileData);
        
        // Extract preview text from first page
        extractPdfPreview(fileData);
      });
      
      updateFileInfo();
      updateFileList();
      convertBtn.disabled = false;
      
      // Reset file input
      pdfUpload.value = '';
      
      showNotification(`${validFiles.length} PDF file(s) uploaded successfully`, 'success');
    }

    function extractPdfPreview(fileData) {
      const reader = new FileReader();
      
      reader.onload = async function(e) {
        try {
          const pdfData = new Uint8Array(e.target.result);
          const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
          
          // Get number of pages
          fileData.pages = pdf.numPages;
          
          // Extract text from first page for preview
          const page = await pdf.getPage(1);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          
          // Limit preview text to 500 characters
          fileData.previewText = pageText.length > 500 ? 
            pageText.substring(0, 500) + '...' : pageText;
          
          updateFileInfo();
          updatePreview();
        } catch (error) {
          console.error('Error extracting PDF preview:', error);
          fileData.previewText = 'Unable to extract text preview';
          updatePreview();
        }
      };
      
      reader.readAsArrayBuffer(fileData.file);
    }

    function updateFileInfo() {
      const totalSizeBytes = pdfFiles.reduce((sum, file) => sum + file.size, 0);
      const totalPages = pdfFiles.reduce((sum, file) => sum + (file.pages || 0), 0);
      
      fileCount.textContent = pdfFiles.length;
      totalSize.textContent = formatFileSize(totalSizeBytes);
      
      // Estimate conversion time
      const estimatedSeconds = pdfFiles.length * 5 + totalPages * 2;
      if (estimatedSeconds < 60) {
        estimatedTime.textContent = `${estimatedSeconds} seconds`;
      } else {
        estimatedTime.textContent = `${Math.ceil(estimatedSeconds / 60)} minutes`;
      }
    }

    function updateFileList() {
      if (pdfFiles.length === 0) {
        fileList.style.display = 'none';
        return;
      }
      
      fileList.style.display = 'block';
      fileList.innerHTML = '<h4>Selected PDFs:</h4>';
      
      pdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
          <div>
            <strong>${file.name}</strong>
            <div style="font-size: 0.8rem; color: #666;">
              ${formatFileSize(file.size)} â€¢ ${file.pages || '?'} pages
            </div>
          </div>
          <button class="remove-file" onclick="removeFile('${file.id}')">
            <i class="fas fa-times"></i>
          </button>
        `;
        fileList.appendChild(fileItem);
      });
    }

    function removeFile(id) {
      pdfFiles = pdfFiles.filter(file => file.id !== id);
      updateFileInfo();
      updateFileList();
      updatePreview();
      
      if (pdfFiles.length === 0) {
        convertBtn.disabled = true;
      }
    }

    function updatePreview() {
      if (pdfFiles.length === 0) {
        emptyPreview.style.display = 'flex';
        previewContent.innerHTML = '';
        return;
      }
      
      emptyPreview.style.display = 'none';
      
      let previewHTML = '';
      pdfFiles.forEach((file, index) => {
        previewHTML += `
          <div class="preview-page">
            <div class="page-header">
              <h4>${file.name}</h4>
              <span class="page-number">${file.pages || '?'} pages</span>
            </div>
            <p>${file.previewText || 'Extracting preview...'}</p>
            <div style="font-size: 0.9rem; color: #666; margin-top: 10px;">
              <i class="fas fa-info-circle"></i> ${formatFileSize(file.size)}
            </div>
          </div>
        `;
      });
      
      previewContent.innerHTML = previewHTML;
    }

    async function convertToWord() {
      if (pdfFiles.length === 0 || isConverting) return;
      
      isConverting = true;
      convertBtn.disabled = true;
      progressContainer.style.display = 'block';
      errorMessage.style.display = 'none';
      
      try {
        // Get conversion settings
        const format = document.querySelector('input[name="format"]:checked').value;
        const useOcr = enableOcr.checked;
        const language = ocrLanguage.value;
        
        // Process each file
        for (let i = 0; i < pdfFiles.length; i++) {
          const file = pdfFiles[i];
          
          // Update progress
          const progress = ((i / pdfFiles.length) * 100).toFixed(0);
          progressFill.style.width = `${progress}%`;
          progressPercentage.textContent = `${progress}%`;
          currentFile.textContent = `Processing: ${file.name}`;
          
          // Simulate processing time
          const estimatedTime = Math.max(2, Math.min(file.pages || 1, 10)) * 1000;
          timeRemaining.textContent = `Approx. ${Math.ceil(estimatedTime / 1000)} seconds remaining`;
          
          // Simulate conversion process (in a real app, this would call an API)
          await simulateConversion(file, format, useOcr, estimatedTime);
          
          // Update progress for this file
          const fileProgress = (((i + 1) / pdfFiles.length) * 100).toFixed(0);
          progressFill.style.width = `${fileProgress}%`;
          progressPercentage.textContent = `${fileProgress}%`;
        }
        
        // Complete progress
        progressFill.style.width = '100%';
        progressPercentage.textContent = '100%';
        currentFile.textContent = 'Conversion complete!';
        timeRemaining.textContent = 'Downloading file...';
        
        // Simulate download
        setTimeout(() => {
          downloadConvertedFile();
          showNotification(`Successfully converted ${pdfFiles.length} file(s) to Word!`, 'success');
          resetConversionState();
        }, 1000);
        
      } catch (error) {
        console.error('Conversion error:', error);
        errorText.textContent = error.message || 'An error occurred during conversion.';
        errorMessage.style.display = 'block';
        resetConversionState();
        showNotification('Conversion failed. Please try again.', 'error');
      }
    }

    async function simulateConversion(file, format, useOcr, duration) {
      return new Promise(resolve => {
        // Simulate processing time
        const startTime = Date.now();
        const interval = setInterval(() => {
          const elapsed = Date.now() - startTime;
          const progress = Math.min((elapsed / duration) * 100, 100);
          
          // Update time remaining estimate
          const remaining = Math.max(0, (duration - elapsed) / 1000);
          timeRemaining.textContent = `Approx. ${Math.ceil(remaining)} seconds remaining`;
          
          if (elapsed >= duration) {
            clearInterval(interval);
            resolve();
          }
        }, 100);
      });
    }

    function downloadConvertedFile() {
      // Create a sample Word document content (simulated)
      const content = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Converted Document</title>
        </head>
        <body>
          <h1>Converted PDF Document</h1>
          <p>This is a simulated Word document converted from PDF.</p>
          <p>In a real application, this would be an actual .docx file generated from the PDF.</p>
          <hr>
          <p><strong>Conversion Details:</strong></p>
          <ul>
            <li>Original PDFs: ${pdfFiles.map(f => f.name).join(', ')}</li>
            <li>Total Pages: ${pdfFiles.reduce((sum, f) => sum + (f.pages || 0), 0)}</li>
            <li>Conversion Date: ${new Date().toLocaleDateString()}</li>
            <li>Format: ${document.querySelector('input[name="format"]:checked').value.toUpperCase()}</li>
            <li>OCR: ${enableOcr.checked ? 'Enabled' : 'Disabled'}</li>
          </ul>
          <p><em>Note: This is a demo. In production, actual PDF to Word conversion would occur here.</em></p>
        </body>
        </html>
      `;
      
      // Create download link
      const blob = new Blob([content], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      
      const format = document.querySelector('input[name="format"]:checked').value;
      const extension = format === 'docx' ? '.docx' : format === 'doc' ? '.doc' : '.rtf';
      const filename = pdfFiles.length === 1 ? 
        pdfFiles[0].name.replace('.pdf', extension) : 
        `converted_documents${extension}`;
      
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function resetConversionState() {
      isConverting = false;
      convertBtn.disabled = pdfFiles.length === 0;
      setTimeout(() => {
        progressContainer.style.display = 'none';
        progressFill.style.width = '0%';
        progressPercentage.textContent = '0%';
      }, 2000);
    }

    function clearAllFiles() {
      if (pdfFiles.length === 0) return;
      
      if (confirm('Are you sure you want to remove all files?')) {
        pdfFiles = [];
        updateFileInfo();
        updateFileList();
        updatePreview();
        convertBtn.disabled = true;
        showNotification('All files cleared', 'info');
      }
    }

    function downloadSamplePdf() {
      // Create a simple sample PDF content
      const sampleContent = `
        %PDF-1.4
        1 0 obj
        << /Type /Catalog /Pages 2 0 R >>
        endobj
        2 0 obj
        << /Type /Pages /Kids [3 0 R] /Count 1 >>
        endobj
        3 0 obj
        << /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R >>
        endobj
        4 0 obj
        << /Length 73 >>
        stream
        BT
        /F1 24 Tf
        100 700 Td
        (Sample PDF Document) Tj
        100 650 Td
        (For testing PDF to Word conversion) Tj
        100 600 Td
        (This is a demo PDF file) Tj
        ET
        endstream
        endobj
        xref
        0 5
        0000000000 65535 f 
        0000000010 00000 n 
        0000000053 00000 n 
        0000000102 00000 n 
        0000000174 00000 n 
        trailer
        << /Size 5 /Root 1 0 R >>
        startxref
        280
        %%EOF
      `;
      
      const blob = new Blob([sampleContent], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sample_document.pdf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Sample PDF downloaded. Upload it to test conversion.', 'info');
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' bytes';
      else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
      else return (bytes / 1048576).toFixed(2) + ' MB';
    }

    function showNotification(message, type = 'success') {
      // Set notification color based on type
      let bgColor, icon;
      switch(type) {
        case 'success':
          bgColor = '#28a745';
          icon = 'fa-check-circle';
          break;
        case 'error':
          bgColor = '#dc3545';
          icon = 'fa-exclamation-circle';
          break;
        case 'warning':
          bgColor = '#ffc107';
          icon = 'fa-exclamation-triangle';
          break;
        case 'info':
          bgColor = '#17a2b8';
          icon = 'fa-info-circle';
          break;
        default:
          bgColor = '#28a745';
          icon = 'fa-check-circle';
      }
      
      notification.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
      notification.style.backgroundColor = bgColor;
      notification.style.display = 'block';
      
      // Auto hide after 4 seconds
      setTimeout(() => {
        notification.style.display = 'none';
      }, 4000);
    }
  </script>
</body>
</html>