<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PDF to Excel Converter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    header {
      background: linear-gradient(to right, #28a745, #218838);
      color: white;
      padding: 25px;
      text-align: center;
    }

    header h1 {
      font-size: 2.2rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    header p {
      opacity: 0.9;
      font-size: 1.1rem;
      max-width: 800px;
      margin: 0 auto;
    }

    .main-content {
      padding: 30px;
    }

    .upload-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .upload-area {
      border: 3px dashed #28a745;
      border-radius: 12px;
      padding: 50px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background-color: white;
      position: relative;
      margin-bottom: 20px;
    }

    .upload-area:hover {
      background-color: #f0fff4;
      border-color: #218838;
      transform: translateY(-3px);
    }

    .upload-area i {
      font-size: 3.5rem;
      color: #28a745;
      margin-bottom: 20px;
    }

    .upload-area h3 {
      margin-bottom: 10px;
      color: #333;
      font-size: 1.6rem;
    }

    .upload-area p {
      color: #666;
      margin-bottom: 5px;
    }

    #file-input {
      display: none;
    }

    .file-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .file-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 15px;
      min-width: 250px;
    }

    .file-icon {
      font-size: 2.5rem;
      color: #dc3545;
    }

    .file-details {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }

    .file-size {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .remove-file {
      color: #dc3545;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .controls-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-title {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      color: #333;
      border-bottom: 2px solid #dee2e6;
      padding-bottom: 10px;
    }

    .section-title i {
      margin-right: 10px;
      color: #28a745;
      font-size: 1.3rem;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .control-group {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .control-group h4 {
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .control-group h4 i {
      color: #28a745;
    }

    .option-row {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      padding: 8px 0;
    }

    .option-row label {
      flex: 1;
      cursor: pointer;
    }

    .option-row input[type="checkbox"],
    .option-row input[type="radio"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .range-control {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 10px;
    }

    .range-control input {
      flex: 1;
    }

    .range-value {
      min-width: 40px;
      text-align: center;
      font-weight: bold;
      color: #28a745;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
      min-width: 200px;
    }

    .action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .primary-btn {
      background: linear-gradient(to right, #28a745, #218838);
      color: white;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }

    .primary-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    .secondary-btn {
      background: white;
      color: #6c757d;
      border: 2px solid #dee2e6;
    }

    .secondary-btn:hover {
      background: #f8f9fa;
      border-color: #28a745;
      color: #28a745;
    }

    .danger-btn {
      background: linear-gradient(to right, #dc3545, #c82333);
      color: white;
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }

    .danger-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
    }

    .processing-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      display: none;
    }

    .progress-container {
      background: white;
      border-radius: 8px;
      padding: 25px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .progress-bar {
      height: 12px;
      background: #e9ecef;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(to right, #28a745, #20c997);
      border-radius: 6px;
      width: 0%;
      transition: width 0.3s;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .progress-details {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .progress-detail {
      text-align: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .progress-detail .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #28a745;
      margin-bottom: 5px;
    }

    .progress-detail .label {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .results-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 30px;
      display: none;
    }

    .results-tabs {
      display: flex;
      border-bottom: 2px solid #dee2e6;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 12px 24px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      color: #6c757d;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .tab-btn:hover {
      color: #28a745;
    }

    .tab-btn.active {
      color: #28a745;
      border-bottom: 2px solid #28a745;
    }

    .tab-content {
      display: none;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .tab-content.active {
      display: block;
    }

    .table-container {
      max-height: 400px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      border: 1px solid #dee2e6;
      padding: 12px;
      text-align: left;
      min-width: 100px;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tr:nth-child(even) {
      background: #f8f9fa;
    }

    .page-preview-container {
      padding: 20px;
      text-align: center;
    }

    .page-preview {
      max-width: 100%;
      max-height: 500px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border-radius: 4px;
    }

    .preview-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .page-nav-btn {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .page-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #current-page {
      font-weight: 600;
      color: #28a745;
    }

    .stats-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-top: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #28a745;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #28a745;
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: none;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 400px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .controls-grid {
        grid-template-columns: 1fr;
      }
      
      .action-btn {
        width: 100%;
      }
      
      .file-info {
        flex-direction: column;
      }
      
      .file-card {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-file-excel"></i> PDF to Excel Converter</h1>
      <p>Convert PDF files to Excel spreadsheets with accurate data extraction</p>
    </header>

    <div class="main-content">
      <div class="upload-section">
        <div class="section-title">
          <i class="fas fa-upload"></i>
          <h3>Upload PDF File</h3>
        </div>
        
        <div class="upload-area" id="upload-area">
          <i class="fas fa-file-pdf"></i>
          <h3>Drop your PDF here</h3>
          <p>Click to browse or drag and drop your PDF file</p>
          <p>Max file size: 50MB | Supports: PDF files only</p>
          <input type="file" id="file-input" accept=".pdf">
        </div>
        
        <div class="file-info" id="file-info">
          <!-- File info will be shown here -->
        </div>
      </div>

      <div class="controls-section">
        <div class="section-title">
          <i class="fas fa-sliders-h"></i>
          <h3>Conversion Settings</h3>
        </div>
        
        <div class="controls-grid">
          <div class="control-group">
            <h4><i class="fas fa-table"></i> Extraction Mode</h4>
            <div class="option-row">
              <input type="radio" id="mode-auto" name="extraction-mode" value="auto" checked>
              <label for="mode-auto">Auto-detect tables</label>
            </div>
            <div class="option-row">
              <input type="radio" id="mode-text" name="extraction-mode" value="text">
              <label for="mode-text">Extract all text</label>
            </div>
            <div class="option-row">
              <input type="radio" id="mode-custom" name="extraction-mode" value="custom">
              <label for="mode-custom">Custom range</label>
            </div>
          </div>
          
          <div class="control-group">
            <h4><i class="fas fa-cog"></i> Processing Options</h4>
            <div class="option-row">
              <input type="checkbox" id="option-headers" checked>
              <label for="option-headers">Detect headers</label>
            </div>
            <div class="option-row">
              <input type="checkbox" id="option-numbers" checked>
              <label for="option-numbers">Keep number formatting</label>
            </div>
            <div class="option-row">
              <input type="checkbox" id="option-merge" checked>
              <label for="option-merge">Merge similar cells</label>
            </div>
            <div class="option-row">
              <input type="checkbox" id="option-formulas">
              <label for="option-formulas">Detect formulas</label>
            </div>
          </div>
          
          <div class="control-group">
            <h4><i class="fas fa-file-export"></i> Output Format</h4>
            <div class="option-row">
              <input type="radio" id="format-xlsx" name="output-format" value="xlsx" checked>
              <label for="format-xlsx">Excel (.xlsx)</label>
            </div>
            <div class="option-row">
              <input type="radio" id="format-csv" name="output-format" value="csv">
              <label for="format-csv">CSV (.csv)</label>
            </div>
            <div class="option-row">
              <input type="radio" id="format-json" name="output-format" value="json">
              <label for="format-json">JSON (.json)</label>
            </div>
          </div>
          
          <div class="control-group">
            <h4><i class="fas fa-filter"></i> Page Range</h4>
            <div class="range-control">
              <span>From:</span>
              <input type="number" id="page-start" min="1" value="1" style="width: 70px;">
              <span>To:</span>
              <input type="number" id="page-end" min="1" value="10" style="width: 70px;">
              <span id="total-pages">/ ?</span>
            </div>
            <div style="margin-top: 15px;">
              <label>Quality: <span id="quality-value">Balanced</span></label>
              <div class="range-control">
                <span>Fast</span>
                <input type="range" id="quality-slider" min="1" max="3" value="2" step="1">
                <span>Accurate</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="action-buttons">
          <button id="convert-btn" class="action-btn primary-btn" disabled>
            <i class="fas fa-sync-alt"></i> Convert to Excel
          </button>
          <button id="preview-btn" class="action-btn secondary-btn" disabled>
            <i class="fas fa-eye"></i> Preview PDF
          </button>
          <button id="clear-btn" class="action-btn danger-btn">
            <i class="fas fa-trash-alt"></i> Clear All
          </button>
        </div>
      </div>

      <div class="processing-section" id="processing-section">
        <div class="section-title">
          <i class="fas fa-cogs"></i>
          <h3>Processing PDF</h3>
        </div>
        
        <div class="progress-container">
          <div class="progress-header">
            <h4>Converting PDF to Excel...</h4>
            <span id="progress-percent">0%</span>
          </div>
          
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          
          <div class="progress-info">
            <span id="progress-status">Initializing...</span>
            <span id="progress-time">0s</span>
          </div>
          
          <div class="progress-details">
            <div class="progress-detail">
              <div class="value" id="pages-processed">0</div>
              <div class="label">Pages Processed</div>
            </div>
            <div class="progress-detail">
              <div class="value" id="tables-found">0</div>
              <div class="label">Tables Found</div>
            </div>
            <div class="progress-detail">
              <div class="value" id="rows-extracted">0</div>
              <div class="label">Rows Extracted</div>
            </div>
            <div class="progress-detail">
              <div class="value" id="cells-extracted">0</div>
              <div class="label">Cells Extracted</div>
            </div>
          </div>
        </div>
      </div>

      <div class="results-section" id="results-section">
        <div class="section-title">
          <i class="fas fa-chart-bar"></i>
          <h3>Conversion Results</h3>
        </div>
        
        <div class="results-tabs">
          <button class="tab-btn active" data-tab="excel">Excel Preview</button>
          <button class="tab-btn" data-tab="pdf">PDF Preview</button>
          <button class="tab-btn" data-tab="raw">Raw Text</button>
        </div>
        
        <div id="excel-tab" class="tab-content active">
          <div class="table-container">
            <table id="excel-preview">
              <thead id="table-head">
                <tr>
                  <th>Column A</th>
                  <th>Column B</th>
                  <th>Column C</th>
                </tr>
              </thead>
              <tbody id="table-body">
                <tr>
                  <td colspan="3" style="text-align: center; padding: 50px; color: #6c757d;">
                    <i class="fas fa-table" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    No data extracted yet. Convert a PDF to see the Excel preview.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div id="pdf-tab" class="tab-content">
          <div class="page-preview-container">
            <canvas id="pdf-canvas" class="page-preview"></canvas>
            <div class="preview-controls">
              <button id="prev-page" class="page-nav-btn">
                <i class="fas fa-chevron-left"></i> Previous
              </button>
              <div>
                Page: <span id="current-page">1</span> of <span id="total-pages-preview">?</span>
              </div>
              <button id="next-page" class="page-nav-btn">
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div id="raw-tab" class="tab-content">
          <div style="padding: 20px; background: white; border-radius: 8px; max-height: 400px; overflow-y: auto;">
            <pre id="raw-text" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9rem;">
              Extracted text will appear here...
            </pre>
          </div>
        </div>
        
        <div class="action-buttons" style="margin-top: 30px;">
          <button id="download-excel-btn" class="action-btn primary-btn" disabled>
            <i class="fas fa-file-excel"></i> Download Excel
          </button>
          <button id="download-csv-btn" class="action-btn secondary-btn" disabled>
            <i class="fas fa-file-csv"></i> Download CSV
          </button>
          <button id="download-json-btn" class="action-btn secondary-btn" disabled>
            <i class="fas fa-file-code"></i> Download JSON
          </button>
          <button id="copy-data-btn" class="action-btn secondary-btn" disabled>
            <i class="fas fa-copy"></i> Copy Data
          </button>
        </div>
      </div>

      <div class="stats-section" id="stats-section">
        <div class="section-title">
          <i class="fas fa-chart-pie"></i>
          <h3>Conversion Statistics</h3>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="stat-pages">0</div>
            <div class="stat-label">Total Pages</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-tables">0</div>
            <div class="stat-label">Tables Found</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-rows">0</div>
            <div class="stat-label">Rows Extracted</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-columns">0</div>
            <div class="stat-label">Columns</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-size">0 KB</div>
            <div class="stat-label">File Size</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="stat-time">0s</div>
            <div class="stat-label">Processing Time</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // DOM Elements
    const fileInput = document.getElementById('file-input');
    const uploadArea = document.getElementById('upload-area');
    const fileInfo = document.getElementById('file-info');
    const convertBtn = document.getElementById('convert-btn');
    const previewBtn = document.getElementById('preview-btn');
    const clearBtn = document.getElementById('clear-btn');
    const processingSection = document.getElementById('processing-section');
    const resultsSection = document.getElementById('results-section');
    const statsSection = document.getElementById('stats-section');
    
    // Progress elements
    const progressFill = document.getElementById('progress-fill');
    const progressPercent = document.getElementById('progress-percent');
    const progressStatus = document.getElementById('progress-status');
    const progressTime = document.getElementById('progress-time');
    const pagesProcessed = document.getElementById('pages-processed');
    const tablesFound = document.getElementById('tables-found');
    const rowsExtracted = document.getElementById('rows-extracted');
    const cellsExtracted = document.getElementById('cells-extracted');
    
    // Tab elements
    const tabButtons = document.querySelectorAll('.tab-btn');
    const excelTab = document.getElementById('excel-tab');
    const pdfTab = document.getElementById('pdf-tab');
    const rawTab = document.getElementById('raw-tab');
    
    // PDF preview elements
    const pdfCanvas = document.getElementById('pdf-canvas');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesPreview = document.getElementById('total-pages-preview');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    // Download buttons
    const downloadExcelBtn = document.getElementById('download-excel-btn');
    const downloadCsvBtn = document.getElementById('download-csv-btn');
    const downloadJsonBtn = document.getElementById('download-json-btn');
    const copyDataBtn = document.getElementById('copy-data-btn');
    
    // Table elements
    const tableHead = document.getElementById('table-head');
    const tableBody = document.getElementById('table-body');
    const rawText = document.getElementById('raw-text');
    
    // Stats elements
    const statPages = document.getElementById('stat-pages');
    const statTables = document.getElementById('stat-tables');
    const statRows = document.getElementById('stat-rows');
    const statColumns = document.getElementById('stat-columns');
    const statSize = document.getElementById('stat-size');
    const statTime = document.getElementById('stat-time');
    
    // Notification
    const notification = document.getElementById('notification');
    
    // State variables
    let currentPDF = null;
    let pdfDoc = null;
    let currentPage = 1;
    let totalPages = 0;
    let extractedData = [];
    let rawExtractedText = '';
    let conversionStartTime = null;
    let conversionStats = {
      pages: 0,
      tables: 0,
      rows: 0,
      columns: 0,
      processingTime: 0
    };
    
    // Event Listeners
    uploadArea.addEventListener('click', () => fileInput.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = '#f0fff4';
      uploadArea.style.borderColor = '#218838';
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.backgroundColor = 'white';
      uploadArea.style.borderColor = '#28a745';
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = 'white';
      uploadArea.style.borderColor = '#28a745';
      
      if (e.dataTransfer.files.length) {
        handleFileUpload(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', (event) => {
      if (event.target.files.length) {
        handleFileUpload(event.target.files[0]);
      }
    });

    convertBtn.addEventListener('click', convertPDFToExcel);
    previewBtn.addEventListener('click', previewPDF);
    clearBtn.addEventListener('click', clearAll);

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
        
        // If PDF tab is selected and PDF is loaded, render the current page
        if (btn.dataset.tab === 'pdf' && pdfDoc) {
          renderPDFPage(currentPage);
        }
      });
    });

    prevPageBtn.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderPDFPage(currentPage);
      }
    });

    nextPageBtn.addEventListener('click', () => {
      if (pdfDoc && currentPage < pdfDoc.numPages) {
        currentPage++;
        renderPDFPage(currentPage);
      }
    });

    downloadExcelBtn.addEventListener('click', downloadExcel);
    downloadCsvBtn.addEventListener('click', downloadCSV);
    downloadJsonBtn.addEventListener('click', downloadJSON);
    copyDataBtn.addEventListener('click', copyDataToClipboard);

    // Functions
    function handleFileUpload(file) {
      if (!file.name.toLowerCase().endsWith('.pdf')) {
        showNotification('Please upload a PDF file', '#dc3545');
        return;
      }
      
      if (file.size > 50 * 1024 * 1024) {
        showNotification('File size must be less than 50MB', '#dc3545');
        return;
      }
      
      currentPDF = file;
      
      // Update file info display
      fileInfo.innerHTML = `
        <div class="file-card">
          <div class="file-icon">
            <i class="fas fa-file-pdf"></i>
          </div>
          <div class="file-details">
            <div class="file-name" title="${file.name}">${file.name}</div>
            <div class="file-size">${formatFileSize(file.size)}</div>
          </div>
          <button class="remove-file" onclick="removeCurrentFile()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      // Enable buttons
      convertBtn.disabled = false;
      previewBtn.disabled = false;
      
      // Update page range inputs
      document.getElementById('total-pages').textContent = '/ ?';
      
      showNotification(`PDF loaded: ${file.name}`, '#28a745');
    }

    function removeCurrentFile() {
      currentPDF = null;
      pdfDoc = null;
      fileInfo.innerHTML = '';
      convertBtn.disabled = true;
      previewBtn.disabled = true;
      resultsSection.style.display = 'none';
      statsSection.style.display = 'none';
    }

    async function previewPDF() {
      if (!currentPDF) return;
      
      try {
        const arrayBuffer = await currentPDF.arrayBuffer();
        const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
        
        pdfDoc = await loadingTask.promise;
        totalPages = pdfDoc.numPages;
        currentPage = 1;
        
        // Update page range inputs
        document.getElementById('page-end').value = totalPages;
        document.getElementById('total-pages').textContent = `/ ${totalPages}`;
        totalPagesPreview.textContent = totalPages;
        
        // Switch to PDF preview tab
        document.querySelector('[data-tab="pdf"]').click();
        
        // Render first page
        await renderPDFPage(currentPage);
        
        // Show results section if hidden
        resultsSection.style.display = 'block';
        
      } catch (error) {
        console.error('Error loading PDF:', error);
        showNotification('Error loading PDF file', '#dc3545');
      }
    }

    async function renderPDFPage(pageNum) {
      if (!pdfDoc) return;
      
      try {
        const page = await pdfDoc.getPage(pageNum);
        const viewport = page.getViewport({ scale: 1.5 });
        
        // Set canvas dimensions
        pdfCanvas.height = viewport.height;
        pdfCanvas.width = viewport.width;
        
        // Render PDF page
        const renderContext = {
          canvasContext: pdfCanvas.getContext('2d'),
          viewport: viewport
        };
        
        await page.render(renderContext).promise;
        
        // Update page navigation
        currentPageSpan.textContent = pageNum;
        prevPageBtn.disabled = pageNum <= 1;
        nextPageBtn.disabled = pageNum >= pdfDoc.numPages;
        
      } catch (error) {
        console.error('Error rendering PDF page:', error);
      }
    }

    async function convertPDFToExcel() {
      if (!currentPDF) return;
      
      try {
        // Show processing section
        processingSection.style.display = 'block';
        resultsSection.style.display = 'block';
        statsSection.style.display = 'block';
        
        // Reset progress
        progressFill.style.width = '0%';
        progressPercent.textContent = '0%';
        progressStatus.textContent = 'Starting conversion...';
        conversionStartTime = Date.now();
        updateProgressTimer();
        
        // Reset stats
        conversionStats = {
          pages: 0,
          tables: 0,
          rows: 0,
          columns: 0,
          processingTime: 0
        };
        
        // Get conversion settings
        const mode = document.querySelector('input[name="extraction-mode"]:checked').value;
        const format = document.querySelector('input[name="output-format"]:checked').value;
        const pageStart = parseInt(document.getElementById('page-start').value);
        const pageEnd = parseInt(document.getElementById('page-end').value);
        
        // Load PDF
        progressStatus.textContent = 'Loading PDF...';
        const arrayBuffer = await currentPDF.arrayBuffer();
        const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
        pdfDoc = await loadingTask.promise;
        totalPages = pdfDoc.numPages;
        
        // Validate page range
        const startPage = Math.max(1, Math.min(pageStart, totalPages));
        const endPage = Math.min(totalPages, Math.max(pageEnd, startPage));
        
        // Extract data from PDF
        progressStatus.textContent = 'Extracting data...';
        extractedData = [];
        rawExtractedText = '';
        
        for (let pageNum = startPage; pageNum <= endPage; pageNum++) {
          // Update progress
          const progress = (pageNum - startPage + 1) / (endPage - startPage + 1);
          progressFill.style.width = `${progress * 100}%`;
          progressPercent.textContent = `${Math.round(progress * 100)}%`;
          pagesProcessed.textContent = pageNum - startPage + 1;
          
          // Get page text content
          const page = await pdfDoc.getPage(pageNum);
          const textContent = await page.getTextContent();
          
          // Extract text items
          const pageText = textContent.items.map(item => item.str).join(' ');
          rawExtractedText += `Page ${pageNum}:\n${pageText}\n\n`;
          
          // Simple table detection (this is a simplified version)
          // In a real application, you would use more advanced table detection algorithms
          const lines = pageText.split('\n').filter(line => line.trim() !== '');
          
          // Check if this looks like tabular data
          if (lines.length > 2 && lines.some(line => line.includes('  ') || line.includes('\t'))) {
            conversionStats.tables++;
            tablesFound.textContent = conversionStats.tables;
            
            // Parse tabular data
            const tableData = parseTabularData(lines);
            extractedData = extractedData.concat(tableData);
            
            rowsExtracted.textContent = extractedData.length;
            cellsExtracted.textContent = extractedData.reduce((sum, row) => sum + row.length, 0);
          }
          
          conversionStats.pages++;
          await new Promise(resolve => setTimeout(resolve, 100)); // Simulate processing
        }
        
        // If no tables found, use all text as data
        if (extractedData.length === 0) {
          const lines = rawExtractedText.split('\n').filter(line => line.trim() !== '');
          extractedData = lines.map(line => [line]);
          rowsExtracted.textContent = extractedData.length;
          cellsExtracted.textContent = extractedData.length;
        }
        
        // Update columns count
        conversionStats.columns = extractedData.length > 0 
          ? Math.max(...extractedData.map(row => row.length)) 
          : 0;
        conversionStats.rows = extractedData.length;
        
        // Process completion
        progressStatus.textContent = 'Finalizing...';
        progressFill.style.width = '100%';
        progressPercent.textContent = '100%';
        
        // Update stats
        updateConversionStats();
        
        // Update table preview
        updateTablePreview();
        
        // Update raw text
        rawText.textContent = rawExtractedText || 'No text extracted';
        
        // Enable download buttons
        downloadExcelBtn.disabled = false;
        downloadCsvBtn.disabled = false;
        downloadJsonBtn.disabled = false;
        copyDataBtn.disabled = false;
        
        // Switch to Excel preview tab
        document.querySelector('[data-tab="excel"]').click();
        
        showNotification(`PDF converted successfully! Extracted ${conversionStats.rows} rows of data.`, '#28a745');
        
      } catch (error) {
        console.error('Error converting PDF:', error);
        showNotification('Error converting PDF: ' + error.message, '#dc3545');
        progressStatus.textContent = 'Error occurred';
      } finally {
        // Hide processing section after a delay
        setTimeout(() => {
          processingSection.style.display = 'none';
        }, 2000);
      }
    }

    function parseTabularData(lines) {
      // Simple tabular data parser
      // This is a basic implementation - real PDF table extraction is more complex
      const tableData = [];
      
      for (let line of lines) {
        // Split by multiple spaces or tabs
        const cells = line.split(/\s{2,}|\t/).filter(cell => cell.trim() !== '');
        if (cells.length > 1) {
          tableData.push(cells);
        }
      }
      
      return tableData;
    }

    function updateTablePreview() {
      tableHead.innerHTML = '';
      tableBody.innerHTML = '';
      
      if (extractedData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="3" style="text-align: center; padding: 50px; color: #6c757d;">
              <i class="fas fa-table" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
              No data extracted. Try a different PDF or adjust extraction settings.
            </td>
          </tr>
        `;
        return;
      }
      
      // Create header
      const headerRow = document.createElement('tr');
      const maxCols = Math.min(conversionStats.columns, 10); // Limit columns for preview
      
      for (let i = 0; i < maxCols; i++) {
        const th = document.createElement('th');
        th.textContent = `Column ${String.fromCharCode(65 + i)}`;
        headerRow.appendChild(th);
      }
      tableHead.appendChild(headerRow);
      
      // Create rows (limit to 50 rows for preview)
      const previewRows = Math.min(extractedData.length, 50);
      
      for (let i = 0; i < previewRows; i++) {
        const row = document.createElement('tr');
        const rowData = extractedData[i];
        
        for (let j = 0; j < maxCols; j++) {
          const td = document.createElement('td');
          td.textContent = j < rowData.length ? rowData[j] : '';
          row.appendChild(td);
        }
        
        tableBody.appendChild(row);
      }
      
      // Add notice if rows were truncated
      if (extractedData.length > previewRows) {
        const noticeRow = document.createElement('tr');
        const noticeCell = document.createElement('td');
        noticeCell.colSpan = maxCols;
        noticeCell.style.textAlign = 'center';
        noticeCell.style.color = '#6c757d';
        noticeCell.style.fontStyle = 'italic';
        noticeCell.textContent = `... and ${extractedData.length - previewRows} more rows`;
        noticeRow.appendChild(noticeCell);
        tableBody.appendChild(noticeRow);
      }
    }

    function updateConversionStats() {
      const processingTime = Math.round((Date.now() - conversionStartTime) / 1000);
      
      statPages.textContent = conversionStats.pages;
      statTables.textContent = conversionStats.tables;
      statRows.textContent = conversionStats.rows;
      statColumns.textContent = conversionStats.columns;
      statSize.textContent = formatFileSize(currentPDF.size);
      statTime.textContent = `${processingTime}s`;
      
      conversionStats.processingTime = processingTime;
    }

    function updateProgressTimer() {
      if (!conversionStartTime) return;
      
      const interval = setInterval(() => {
        if (!conversionStartTime) {
          clearInterval(interval);
          return;
        }
        
        const elapsed = Math.floor((Date.now() - conversionStartTime) / 1000);
        progressTime.textContent = `${elapsed}s`;
      }, 1000);
    }

    function downloadExcel() {
      if (extractedData.length === 0) return;
      
      try {
        // Convert data to worksheet
        const ws = XLSX.utils.aoa_to_sheet(extractedData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Extracted Data");
        
        // Generate Excel file
        const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
        const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        
        // Create download link
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.href = url;
        link.download = `extracted_data_${Date.now()}.xlsx`;
        link.click();
        
        URL.revokeObjectURL(url);
        
        showNotification('Excel file downloaded successfully!', '#28a745');
        
      } catch (error) {
        console.error('Error creating Excel file:', error);
        showNotification('Error creating Excel file', '#dc3545');
      }
    }

    function downloadCSV() {
      if (extractedData.length === 0) return;
      
      try {
        // Convert data to CSV
        const csvContent = extractedData.map(row => 
          row.map(cell => {
            // Escape quotes and wrap in quotes if needed
            const escaped = cell.replace(/"/g, '""');
            return cell.includes(',') || cell.includes('"') || cell.includes('\n') 
              ? `"${escaped}"` 
              : cell;
          }).join(',')
        ).join('\n');
        
        // Create blob and download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.href = url;
        link.download = `extracted_data_${Date.now()}.csv`;
        link.click();
        
        URL.revokeObjectURL(url);
        
        showNotification('CSV file downloaded successfully!', '#28a745');
        
      } catch (error) {
        console.error('Error creating CSV file:', error);
        showNotification('Error creating CSV file', '#dc3545');
      }
    }

    function downloadJSON() {
      if (extractedData.length === 0) return;
      
      try {
        // Convert data to JSON
        const jsonData = {
          metadata: {
            source: currentPDF.name,
            pages: conversionStats.pages,
            tables: conversionStats.tables,
            rows: conversionStats.rows,
            columns: conversionStats.columns,
            extractedAt: new Date().toISOString()
          },
          data: extractedData
        };
        
        const jsonContent = JSON.stringify(jsonData, null, 2);
        
        // Create blob and download
        const blob = new Blob([jsonContent], { type: 'application/json' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.href = url;
        link.download = `extracted_data_${Date.now()}.json`;
        link.click();
        
        URL.revokeObjectURL(url);
        
        showNotification('JSON file downloaded successfully!', '#28a745');
        
      } catch (error) {
        console.error('Error creating JSON file:', error);
        showNotification('Error creating JSON file', '#dc3545');
      }
    }

    function copyDataToClipboard() {
      if (extractedData.length === 0) return;
      
      try {
        // Convert to tab-separated values for clipboard
        const tsvContent = extractedData.map(row => row.join('\t')).join('\n');
        
        navigator.clipboard.writeText(tsvContent)
          .then(() => {
            showNotification('Data copied to clipboard!', '#28a745');
          })
          .catch(err => {
            console.error('Failed to copy data:', err);
            showNotification('Failed to copy data', '#dc3545');
          });
          
      } catch (error) {
        console.error('Error copying data:', error);
        showNotification('Error copying data', '#dc3545');
      }
    }

    function clearAll() {
      currentPDF = null;
      pdfDoc = null;
      extractedData = [];
      rawExtractedText = '';
      
      // Reset UI
      fileInfo.innerHTML = '';
      convertBtn.disabled = true;
      previewBtn.disabled = true;
      processingSection.style.display = 'none';
      resultsSection.style.display = 'none';
      statsSection.style.display = 'none';
      
      // Reset table
      tableHead.innerHTML = '<tr><th>Column A</th><th>Column B</th><th>Column C</th></tr>';
      tableBody.innerHTML = `
        <tr>
          <td colspan="3" style="text-align: center; padding: 50px; color: #6c757d;">
            <i class="fas fa-table" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
            No data extracted yet. Convert a PDF to see the Excel preview.
          </td>
        </tr>
      `;
      
      // Reset raw text
      rawText.textContent = 'Extracted text will appear here...';
      
      // Reset stats
      statPages.textContent = '0';
      statTables.textContent = '0';
      statRows.textContent = '0';
      statColumns.textContent = '0';
      statSize.textContent = '0 KB';
      statTime.textContent = '0s';
      
      // Reset progress
      progressFill.style.width = '0%';
      progressPercent.textContent = '0%';
      progressStatus.textContent = 'Initializing...';
      progressTime.textContent = '0s';
      pagesProcessed.textContent = '0';
      tablesFound.textContent = '0';
      rowsExtracted.textContent = '0';
      cellsExtracted.textContent = '0';
      
      // Disable download buttons
      downloadExcelBtn.disabled = true;
      downloadCsvBtn.disabled = true;
      downloadJsonBtn.disabled = true;
      copyDataBtn.disabled = true;
      
      showNotification('All data cleared', '#6c757d');
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      else return (bytes / 1048576).toFixed(2) + ' MB';
    }

    function showNotification(message, color = '#28a745') {
      notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
      notification.style.backgroundColor = color;
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Initialize page
    document.getElementById('quality-slider').addEventListener('input', function() {
      const qualityText = ['Fast', 'Balanced', 'Accurate'][this.value - 1];
      document.getElementById('quality-value').textContent = qualityText;
    });
  </script>
</body>
</html>